<div
  class="container-question-list-view flex max-h-[calc(100dvh-4rem)] w-full flex-col"
  tabindex="0"
  aria-label="Panneau de sélection des questions"
  role="menu"
  (keydown)="onKeyDown($event)"
>
  <div #questionContainer class="flex max-h-10/12 flex-col gap-3 overflow-y-auto px-3 py-4">
    @for (question of questions(); track $index) {
      <div class="flex flex-row">
        <!-- QUESTION ACTION BAR -->
        <div class="w-13">
          <div
            class="h-full rounded-l-lg py-2 text-center"
            [class.hidden]="selectedIdx() !== $index"
          >
            <button
              class="mb-2 bg-neutral-100! dark:bg-neutral-900!"
              pButton
              ariaLabel="Dupliquer la question"
              text
              raised
              severity="contrast"
              size="small"
              rounded
              (click)="onDuplicateQuestion($index)"
            >
              <quizz-icon name="copy" pButtonIcon />
            </button>
            <button
              class="mb-2 bg-neutral-100! dark:bg-neutral-900!"
              pButton
              ariaLabel="Supprimer la question"
              text
              raised
              severity="danger"
              size="small"
              rounded
              [disabled]="questions().length <= 1"
              (click)="onDeleteQuestion($event, $index)"
            >
              <quizz-icon name="trash" pButtonIcon />
            </button>
            <p-confirmpopup
              #cp
              [pt]="{
                root: { 'aria-label': 'Confirmez vouloir supprimer la question', tabindex: 0 },
              }"
            >
              <ng-template #headless let-message>
                <div class="rounded p-4">
                  <span><quizz-icon name="trash" /> Supprimer ?</span>
                  <div class="mt-4 flex items-center gap-2">
                    <p-button size="small" severity="danger" (onClick)="cp.onAccept()">
                      <quizz-icon name="confirm" pButtonIcon />
                    </p-button>
                    <p-button size="small" severity="primary" (onClick)="cp.onReject()">
                      <quizz-icon name="cancel" pButtonIcon />
                    </p-button>
                  </div>
                </div>
              </ng-template>
            </p-confirmpopup>
          </div>
        </div>

        <!-- QUESTION PREVIEW BUTTON -->
        <button
          class="question-frame relative w-50 flex-col"
          pButton
          text
          [aria-label]="
            `Sélectionner la question ${$index + 1} de type ${QuestionTypeFrom(question.type).toString()}`
          "
          [class.selected]="selectedIdx() === $index"
          (click)="onSelectQuestion($index)"
        >
          <div class="mb-2 flex h-full w-full justify-between">
            <span class="font-mono">{{ $index + 1 }}</span>
            <span>{{ QuestionTypeFrom(question.type).toString() }}</span>
          </div>
          <p class="mb-8 line-clamp-2 min-h-13 grow">
            {{ question.value }}
          </p>
          <p-tag
            class="badge-question-count absolute bottom-1 left-1 font-mono"
            rounded="true"
            [value]="`${question.answers.length}`"
            [ariaLabel]="`${question.answers.length} réponses`"
          />
          <p-tag
            class="badge-limit absolute right-1 bottom-1 font-mono"
            rounded="true"
            [value]="`${question.limit?.seconds ? (question.limit!.seconds | minutes) : '∞'}`"
            [ariaLabel]="
              question.limit
                ? `Durée de la question : ${question.limit.seconds} secondes`
                : 'Pas de durée définie pour cette question'
            "
          />
        </button>
      </div>
    }
  </div>

  <button pButton severity="primary" class="m-4 ms-10" (click)="onAddQuestion()">
    <quizz-icon name="plus" pButtonIcon />
    <span pButtonLabel>Ajouter une question</span>
  </button>
</div>
